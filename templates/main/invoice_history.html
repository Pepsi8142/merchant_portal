<!-- invoice_history.html -->
{% extends 'main/base.html' %}
{% block title %}Invoice History{% endblock %}

{% block content %}
<h1>Transaction History</h1>
{% if user_invoices %}
<table class="table">
  <thead>
    <tr>
        <th scope="col">Invoice ID</th>
        <th scope="col">Invoice Date</th>
        <th scope="col">Customer Name</th>
        <th scope="col">Customer Contact</th>
        <th scope="col">Product</th>
        <th scope="col">Quantity</th>
        <th scope="col">Total Price</th>
    </tr>
  </thead>
  <tbody>
    {% for invoice in user_invoices %}
    <tr>
        <td rowspan="{{ invoice.invoiceitem_set.count }}">{{ invoice.id }}</td>
        <td rowspan="{{ invoice.invoiceitem_set.count }}">{{ invoice.generated_on }}</td>
        <td rowspan="{{ invoice.invoiceitem_set.count }}">{{ invoice.customer.name }}</td>
        <td rowspan="{{ invoice.invoiceitem_set.count }}">{{ invoice.customer.phone }}</td>
        {% for item in invoice.invoiceitem_set.all %}
        <td>{{ item.product.title }}</td>
        <td>{{ item.quantity }}</td>
        <td>{{ item.total_price }}</td>
    </tr>
    {% if not forloop.last %}
    <tr>
    {% endif %}
        {% endfor %}
    {% endfor %}
  </tbody>
</table>
{% else %}
<p>No invoice history found for {{ request.user.username }}.</p>
{% endif %}
{% endblock %}
